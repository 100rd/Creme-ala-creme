replicaCount: 2

image:
  repository: ghcr.io/your-org/hello-world
  tag: "latest"
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 80

containerPort: 8080

healthProbes:
  readinessPath: /readyz
  livenessPath: /livez

resources:
  requests:
    cpu: "50m"
    memory: "64Mi"
  limits:
    cpu: "500m"
    memory: "256Mi"

podAnnotations: {}

serviceAccount:
  create: true
  name: ""
  annotations: {}
  # For IRSA (AWS EKS), set the role ARN:
  # annotations:
  #   eks.amazonaws.com/role-arn: "arn:aws:iam::123456789012:role/hello-world-secrets"

securityContext:
  runAsNonRoot: true
  runAsUser: 65532
  runAsGroup: 65532
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop: ["ALL"]
  seccompProfile:
    type: RuntimeDefault

ingress:
  enabled: false
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: hello-world.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: hello-world-tls
      hosts:
        - hello-world.example.com

hpa:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70

pdb:
  enabled: true
  minAvailable: 1

serviceMonitor:
  enabled: true
  interval: 30s
  scrapeTimeout: 10s
  path: /metrics

networkPolicy:
  enabled: true
  defaultDeny: true
  allowEgress:
    - toNamespaceSelector: {}
      toPodSelector:
        matchLabels:
          app: postgres
      ports:
        - port: 5432
          protocol: TCP
    - toNamespaceSelector: {}
      toPodSelector:
        matchLabels:
          app: otel-collector
      ports:
        - port: 4317
          protocol: TCP

env:
  - name: PORT
    value: "8080"
  - name: LOG_LEVEL
    value: "info"
  - name: LOG_FORMAT
    value: "json"
  - name: ENVIRONMENT
    value: "production"
  # SKIP_MIGRATIONS should be true in production (migrations run via Job)
  - name: SKIP_MIGRATIONS
    value: "true"
  # DATABASE_URL is supplied via Secret (created by ExternalSecret or manually)
  - name: DATABASE_URL
    valueFrom:
      secretKeyRef:
        name: hello-world-db
        key: url
  # Feature flags - controlled via OpenFeature/flagd in production
  - name: ENABLE_METRICS
    value: "true"
  - name: ENABLE_TRACING
    value: "true"
  # Admin endpoints should be disabled in production
  - name: ADMIN_FLAGS_ENABLED
    value: "false"
  # OpenFeature / flagd
  - name: FLAGD_HOST
    value: "flagd"
  - name: FLAGD_PORT
    value: "8013"
  # OpenTelemetry
  - name: OTEL_EXPORTER_OTLP_ENDPOINT
    value: "http://otel-collector:4318"
  - name: OTEL_TRACES_EXPORTER
    value: "otlp"
  - name: OTEL_SERVICE_NAME
    value: "hello-world"

# Database migrations configuration
migrations:
  enabled: true
  # Secret containing DATABASE_URL for migrations
  # This secret is created by externalSecret or manually
  secretName: "hello-world-db"
  secretKey: "url"

# SecretStore for External Secrets Operator
# Creates a SecretStore resource pointing to AWS Secrets Manager
# Requires IRSA: set serviceAccount.annotations with eks.amazonaws.com/role-arn
secretStore:
  enabled: false
  region: eu-central-1
  provider: aws  # aws-secrets-manager

# External Secrets Operator integration
# Enables automatic secret synchronization from AWS Secrets Manager
# Requires secretStore.enabled=true (or a pre-existing SecretStore)
externalSecret:
  enabled: false
  secretStoreRef:
    name: "hello-world-aws-sm"
    kind: "SecretStore"
  # Path in secret store (e.g., AWS Secrets Manager ARN or path)
  secretPath: "hello-world/database"
  refreshInterval: "1h"
