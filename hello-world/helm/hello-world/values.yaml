replicaCount: 2

image:
  repository: ghcr.io/your-org/hello-world
  tag: "latest"
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 80

containerPort: 8080

healthProbes:
  readinessPath: /readyz
  livenessPath: /livez

resources:
  requests:
    cpu: "50m"
    memory: "64Mi"
  limits:
    cpu: "500m"
    memory: "256Mi"

podAnnotations: {}

serviceAccount:
  create: true
  name: ""

securityContext:
  runAsNonRoot: true
  runAsUser: 65532
  runAsGroup: 65532
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop: ["ALL"]
  seccompProfile:
    type: RuntimeDefault

ingress:
  enabled: false
  className: ""
  hosts: []
  tls: []

hpa:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70

pdb:
  enabled: true
  minAvailable: 1

serviceMonitor:
  enabled: true
  interval: 30s
  scrapeTimeout: 10s
  path: /metrics

networkPolicy:
  enabled: true
  defaultDeny: true
  allowIngress:
    # Allow service traffic on container port
    - ports:
        - port: 8080
          protocol: TCP
    # Allow Prometheus scraping from monitoring namespace
    - from:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: monitoring
      ports:
        - port: 8080
          protocol: TCP
  allowEgress:
    # DNS resolution (kube-dns)
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: kube-system
      ports:
        - port: 53
          protocol: UDP
        - port: 53
          protocol: TCP
    # Database access
    - to:
        - podSelector:
            matchLabels:
              app: postgres
      ports:
        - port: 5432
          protocol: TCP
    # OpenTelemetry collector
    - to:
        - podSelector:
            matchLabels:
              app: otel-collector
      ports:
        - port: 4317
          protocol: TCP
        - port: 4318
          protocol: TCP

env:
  - name: PORT
    value: "8080"
  - name: LOG_LEVEL
    value: "info"
  - name: LOG_FORMAT
    value: "json"
  - name: ENVIRONMENT
    value: "production"
  # SKIP_MIGRATIONS should be true in production (migrations run via Job)
  - name: SKIP_MIGRATIONS
    value: "true"
  # DATABASE_URL is supplied via Secret (created by ExternalSecret or manually)
  - name: DATABASE_URL
    valueFrom:
      secretKeyRef:
        name: hello-world-db
        key: url
  # Feature flags - controlled via OpenFeature/flagd in production
  - name: ENABLE_METRICS
    value: "true"
  - name: ENABLE_TRACING
    value: "true"
  # Admin endpoints should be disabled in production
  - name: ADMIN_FLAGS_ENABLED
    value: "false"
  # OpenFeature / flagd
  - name: FLAGD_HOST
    value: "flagd"
  - name: FLAGD_PORT
    value: "8013"
  # OpenTelemetry
  - name: OTEL_EXPORTER_OTLP_ENDPOINT
    value: "http://otel-collector:4318"
  - name: OTEL_TRACES_EXPORTER
    value: "otlp"
  - name: OTEL_SERVICE_NAME
    value: "hello-world"

# Database migrations configuration
migrations:
  enabled: true
  # Secret containing DATABASE_URL for migrations
  # This secret is created by externalSecret or manually
  secretName: "hello-world-db"
  secretKey: "url"

# External Secrets Operator integration
# Enables automatic secret synchronization from AWS Secrets Manager, Vault, etc.
externalSecret:
  enabled: false
  secretStoreRef:
    name: "aws-secretsmanager"
    kind: "SecretStore"
  # Path in secret store (e.g., AWS Secrets Manager ARN or path)
  secretPath: "hello-world/database"
  refreshInterval: "1h"

resourceQuota:
  enabled: true
  requestsCpu: "2"
  requestsMemory: "2Gi"
  limitsCpu: "8"
  limitsMemory: "8Gi"
  pods: "20"
